<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ordered Tickets</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
body{background:#f5f7fb;color:#222;padding-bottom:50px}
.header{display:flex;align-items:center;justify-content:space-between;padding:10px 20px;background:#fff;box-shadow:0 2px 4px rgba(0,0,0,0.1);position:sticky;top:0;z-index:10}
.back-btn{padding:4px 8px;border:none;border-radius:6px;background:#e1ecff;color:#007bff;cursor:pointer}
.logo-title{font-weight:bold;color:#007bff;font-size:22px}
.main{padding:20px}
.page-title{font-size:22px;font-weight:bold;margin-bottom:12px}
.info-text{font-size:13px;color:#666;margin-bottom:14px}
.card{background:#fff;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.08);padding:14px;margin-bottom:12px}
.route{font-size:16px;font-weight:bold;margin-bottom:4px}
.badge{font-size:11px;padding:3px 7px;border-radius:999px}
.badge-pending{background:#fff4d8;color:#b98000}
.badge-failed{background:#ffe1e1;color:#c62828}
.sub{font-size:13px;margin-bottom:4px}
.label{font-weight:bold}
.price{font-size:16px;font-weight:bold;color:#007bff;margin-top:8px}
.footer-row{font-size:12px;color:#555;margin-top:6px}
.empty{text-align:center;margin-top:40px;font-size:15px;color:#666}
.footer{position:fixed;bottom:0;width:100%;background:#fff;text-align:center;padding:8px;font-size:13px;box-shadow:0 -1px 4px rgba(0,0,0,0.15)}
</style>
</head>
<body>

<header class="header">
  <button class="back-btn" onclick="window.location.href='home.html'">&#8592;</button>
  <div class="logo-title">Ordered Tickets</div>
</header>

<main class="main">
  <h1 class="page-title">Pending / Waiting Tickets</h1>
  <p class="info-text">Tickets that are not successful will appear here.</p>

  <div id="cards"></div>
  <div id="emptyMsg" class="empty" style="display:none;">No pending tickets.</div>
</main>

<footer class="footer">© 2025 Travel Booking</footer>

<script>
function badge(status){
  const s=(status||"").toLowerCase();
  if(s==="pending"||s==="waiting"||s==="waiting for approval"||s==="processing")
    return '<span class="badge badge-pending">Pending</span>';
  if(s==="failed"||s==="cancelled")
    return '<span class="badge badge-failed">Failed</span>';
  return '<span class="badge badge-pending">'+status+'</span>';
}

function load(){
  const all = JSON.parse(localStorage.getItem("bookings")||"[]");

  // ONLY NON-SUCCESS tickets
  const list = all.filter(b=>{
    const s=(b.status||"").toLowerCase();
    return s!=="success" && s!=="successful";
  });

  const cards=document.getElementById("cards");
  const emptyMsg=document.getElementById("emptyMsg");

  cards.innerHTML="";

  if(list.length===0){
    emptyMsg.style.display="block";
    return;
  }

  emptyMsg.style.display="none";

  list.forEach(t=>{
    const j=t.journey;
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML=`
      <div class="route">${j.from} → ${j.to} &nbsp; ${badge(t.status)}</div>
      <div class="sub"><span class="label">Booking ID:</span> ${t.bookingId}</div>
      <div class="sub"><span class="label">Mode:</span> ${j.type} | ${j.vehicleNo}</div>
      <div class="sub"><span class="label">Journey Date:</span> ${j.date} ${j.time}</div>
      <div class="sub"><span class="label">Passengers:</span> ${t.passengers.length}</div>
      <div class="sub"><span class="label">Txn ID:</span> ${t.txnId}</div>
      <div class="price">₹${t.totalPaid}</div>
      <div class="footer-row">Ordered: ${t.date}</div>
    `;
    cards.appendChild(div);
  });
}
load();
</script>

</body>
</html>
